<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Custom Style Sheet  -->
  <link rel="stylesheet" href="./css/style.css" />
  <title>Bookmark</title>
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">
  <!-- Bulma.io Framework -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.1/css/bulma.min.css"
    integrity="sha512-ZRv40llEogRmoWgZwnsqke3HNzJ0kiI0+pcMgiz2bxO6Ew1DVBtWjVn0qjrXdT3+u+pSN36gLgmJiiQ3cQtyzA=="
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
    integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">


</head>

<body>


  <!--NavBar-->
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="./index.html">
        <img src="../public/img/images1.png" width="112" height="28">
      </a>
      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
        data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="./index.html">Home</a>
        <a class="navbar-item" href="./members.html"> Members</a>
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="buttons">
          <a class="button is-dark" href="./signup.html"><strong>Sign Up</strong></a>
          <a class="button is-light" href="./login.html">Log In</a>
        </div>
      </div>
    </div>
  </nav>
  <!--End of navbar-->

  <section id="forImg" class="section is-medium"
    style="background-color: #4d4d4d;  border-bottom: 3px solid black; border-top: 3px solid black">
    <div class="container columns">
      <div class="column">
        <div id="book-result">

        </div>
      </div>
    </div>
  </section>


  <section class="section2 is-large" style="background-color: #e6e6e6; height: 400px;">
    <div class="container">
      <div class="column has-text-centered">
        <br><br><Br><br><br><br><br><br><br><br>
        <!-- Google Maps -->
        <div class="google-maps">
          <!-- Google Places info -->
          <div id="panel"></div>
          <!-- The actual map -->
          <div id="map"></div>
        </div>
      </div>
    </div>
  </section>



  <!-- Footer -->
  <footer id="toe">
    <div class="ankle">
      <img src="./img/images.png"></div>

      <div class="columns is-multiline is-mobile">
  
        <div class="column is-one-quarter">
          <div class="connect">
            <h6>Creators:</h6>
            <br>
            <ul>
              <li>
                <img class="ourPic" src="./img/70029613.jpg">
                <a href="https://github.com/tiroxxx" target="_blank"><img class="gitPic"
                    src="./img/iconfinder_social__media__social_media__github__3259374 (1).png" title="github"
                    alt="Github"></a>
      
                <img class="ourPic" src="./img/69640390.jpg">
                <a href="https://github.com/brigil" target="_blank"><img class="gitPic"
                    src="./img/iconfinder_social__media__social_media__github__3259374 (1).png" title="github"
                    alt="Github"></a>
              </li>
              <li>
                <img class="ourPic" src="./img/70404735.png">
                <a href="https://github.com/Lyricsduda" target="_blank"><img class="gitPic"
                    src="./img/iconfinder_social__media__social_media__github__3259374 (1).png" title="github"
                    alt="Github"></a>
      
      
                <img class="ourPic" src="./img/70517707.jpg">
                <a href="https://github.com/mora5925" target="_blank"><img class="gitPic"
                    src="./img/iconfinder_social__media__social_media__github__3259374 (1).png" title="github"
                    alt="Github"></a>
              </li>
            </ul>
          </div>
        </div>
        <div class="column is-half">
          <div class="bookQuote">
            <blockquote> <p>“Fairy tales are more than true: not because they tell us that dragons exist, but because they tell us that dragons can be beaten.”
      – Neil Gaiman</p></blockquote>
          </div>
        </div>
        <div class="column is-one-quarter">
          <div class="connect">
            <h6>Quick Links:</h6>
            <br>
            <ul>
              <li><a class="signIn" href="./signup.html"> Sign In</a></li>
              <li><a class="logIn" href="./login.html"> Log In</a></li>
              <li> <a class="members" href="./members.html"> Members</a></li>
              </ul>
        </div>
        </div>
        
      </div>



    <h5 class="copyR"><span class="bookF"> &copy; Book</span><span class="markF">Mark </span> | los-bookies</h5>
  </footer>

  <!--End of Footer-->


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- Script to display Google Maps -->
  <!-- This was writtien in the HTML file because the directions which Google has available demonstrates it this way -->
  <script>
    let pos;
    let map;
    let bounds;
    let infoWindow;
    let currentInfoWindow;
    let service;
    let infoPane;
    function initMap() {
      // Initializing variables
      bounds = new google.maps.LatLngBounds();
      infoWindow = new google.maps.InfoWindow();
      currentInfoWindow = infoWindow;
      infoPane = document.getElementById("panel");

      // Geolocation
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            map = new google.maps.Map(document.getElementById("map"), {
              center: pos,
              zoom: 10,
            });

            bounds.extend(pos);
            infoWindow.setPosition(pos);
            infoWindow.setContent("Location found.");
            infoWindow.open(map);
            map.setCenter(pos);

            // Display places near the user
            getNearbyPlaces(pos);
          },
          () => {
            // Browser supports geolocation, but user denies permission
            handleLocationError(true, infoWindow);
          }
        );
      } else {
        // Browser doesn't support geolocation
        handleLocationError(false, infoWindow);
      }
    }

    // If there is a geolocation error
    function handleLocationError(browserHasGeolocation, infoWindow) {
      // Set default location to Orlando, Florida
      pos = { lat: 28.5492, lng: -81.3798 };
      map = new google.maps.Map(document.getElementById("map"), {
        center: pos,
        zoom: 10,
      });

      // If there is an error, let the user know
      infoWindow.setPosition(pos);
      infoWindow.setContent(
        browserHasGeolocation
          ? "Geolocation permissions denied. Using default location."
          : "Error: Your browser doesn't support geolocation."
      );

      infoWindow.open(map);
      currentInfoWindow = infoWindow;

      // Display places in Orlando, Florida
      getNearbyPlaces(pos);
    }

    // Search for nearby palces
    function getNearbyPlaces(position) {
      let request = {
        location: position,
        rankBy: google.maps.places.RankBy.DISTANCE,
        keyword: "library",
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, nearbyCallback);
    }

    // Handle the results of the search
    function nearbyCallback(results, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
        createMarkers(results);
      }
    }

    // Set a marker at each location
    function createMarkers(places) {
      places.forEach((place) => {
        let marker = new google.maps.Marker({
          position: place.geometry.location,
          map: map,
          title: place.name,
        });

        // Add click listener to each marker
        google.maps.event.addListener(marker, "click", () => {
          let request = {
            placeId: place.place_id,
            fields: [
              "name",
              "formatted_address",
              "geometry",
              "rating",
              "website",
              "photos",
            ],
          };
          // Only fetch the details of a place when the user clicks on a marker
          service.getDetails(request, (placeResult, status) => {
            showDetails(placeResult, marker, status);
          });
        });
        // Adjust the map bounds to include the location of this marker
        bounds.extend(place.geometry.location);
      });
      // Once all the markers have been placed, adjust the bounds of the map to show all the markers within the visible area.
      map.fitBounds(bounds);
    }

    // Displays details above the marker
    function showDetails(placeResult, marker, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
        let placeInfowindow = new google.maps.InfoWindow();
        placeInfowindow.setContent(
          "<div><strong>" +
          placeResult.name +
          "</strong><br>" +
          "Rating: " +
          placeResult.rating +
          "</div>"
        );
        placeInfowindow.open(marker.map, marker);
        currentInfoWindow.close();
        currentInfoWindow = placeInfowindow;
        showPanel(placeResult);
      } else {
        console.log("showDetails failed: " + status);
      }
    }

    function showPanel(placeResult) {
      // If infoPane is already open, close it
      if (infoPane.classList.contains("open")) {
        infoPane.classList.remove("open");
      }

      // Clear the previous details
      while (infoPane.lastChild) {
        infoPane.removeChild(infoPane.lastChild);
      }

      // Display a photo in the info panel if there is one
      if (placeResult.photos != null) {
        let firstPhoto = placeResult.photos[0];
        let photo = document.createElement("img");
        photo.classList.add("hero");
        photo.src = firstPhoto.getUrl();
        infoPane.appendChild(photo);
      }

      // Add place details with text formatting
      let name = document.createElement("h1");
      name.classList.add("place");
      name.textContent = placeResult.name;
      infoPane.appendChild(name);
      if (placeResult.rating != null) {
        let rating = document.createElement("p");
        rating.classList.add("details");
        rating.textContent = `Rating: ${placeResult.rating} \u272e`;
        infoPane.appendChild(rating);
      }

      let address = document.createElement("p");
      address.classList.add("details");
      address.textContent = placeResult.formatted_address;
      infoPane.appendChild(address);
      if (placeResult.website) {
        let websitePara = document.createElement("p");
        let websiteLink = document.createElement("a");
        let websiteUrl = document.createTextNode(placeResult.website);
        websiteLink.appendChild(websiteUrl);
        websiteLink.title = placeResult.website;
        websiteLink.href = placeResult.website;
        websitePara.appendChild(websiteLink);
        infoPane.appendChild(websitePara);
      }

      // Open the infoPane
      infoPane.classList.add("open");
    }


    var url = window.location.search;
    var bookId = url.split("=")[1];


      function showPanel(placeResult) {
        // If infoPane is already open, close it
        if (infoPane.classList.contains("open")) {
          infoPane.classList.remove("open");
        }

        // Clear the previous details
        while (infoPane.lastChild) {
          infoPane.removeChild(infoPane.lastChild);
        }

        // Display a photo in the info panel if there is one
        if (placeResult.photos != null) {
          let firstPhoto = placeResult.photos[0];
          let photo = document.createElement("img");
          photo.classList.add("hero");
          photo.src = firstPhoto.getUrl();
          infoPane.appendChild(photo);
        }

        // Add place details with text formatting
        let name = document.createElement("h1");
        name.classList.add("place");
        name.textContent = placeResult.name;
        infoPane.appendChild(name);
        if (placeResult.rating != null) {
          let rating = document.createElement("p1");
          rating.classList.add("details");
          rating.textContent = `Rating: ${placeResult.rating} \u272e`;
          infoPane.appendChild(rating);
        }

        let address = document.createElement("p");
        address.classList.add("details");
        address.textContent = placeResult.formatted_address;
        infoPane.appendChild(address);
        if (placeResult.website) {
          let websitePara = document.createElement("p");
          let websiteLink = document.createElement("a");
          let websiteUrl = document.createTextNode(placeResult.website);
          websiteLink.appendChild(websiteUrl);
          websiteLink.title = placeResult.website;
          websiteLink.href = placeResult.website;
          websitePara.appendChild(websiteLink);
          infoPane.appendChild(websitePara);
        }

        // Open the infoPane
        infoPane.classList.add("open");

        
        
        getBook(bookId);

    function getBook(bookId) {
      console.log(bookId)
      $.get("/api/search/" + bookId, (book) => {
        displayBook(book);
      });
    }

    function displayBook(book) {
      console.log(book);
      const bookResult = $("#book-result");
      bookResult.empty();
      const row = $("<div>");
      const column = $("<div>");
      const columnTwo = $("<div>");
      row.addClass("columns")
      column.addClass("column")
      columnTwo.addClass("column")

      if (book.cover_link !== null && book.cover_link !== "") {
        column.append("<a href='/book?book_id=" + book.id + "'><img src='" + book.cover_link + "' alt='book cover'></a>");
      }
      else {
        columnTwo.append("<a href='/book?book_id=" + book.id + "'><img src='https://via.placeholder.com/150'></a>");
      }
      columnTwo.append("<p>Title: " + book.title + "</p>");
      columnTwo.append("<p>Author: " + book.author + "</p>");
      if (book.average_rating !== null) {
        columnTwo.append("<p>Rating: " + book.average_rating + "</p>");
      }
      else {
        columnTwo.append("<p>Rating: N/A</p>");
      }
      columnTwo.append("<p>Number of Pages: " + book.number_of_pages + "</p>");
      columnTwo.append("<p>Date Published: " + book.date_published + "</p>");
      columnTwo.append("<p>Publisher: " + book.publisher + "</p>");
      if (book.genre !== null || book.genre !== "")
      columnTwo.append("<p>Genre(s): " + book.genre + "</p>");
      columnTwo.append("<a href='" + book.amazon_link + "' target='__blank'>Buy Now!</a>");
      columnTwo.append("<p>Description: " + book.description + "</p>");

      row.append(column);
      row.append(columnTwo);
      bookResult.append(row);
    }






  </script>

  <!-- Google Maps API -->
  <!-- API Key: AIzaSyDWtRQlguUx0Uhj3jgmV0e1UwUDsNQ9gPs -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWtRQlguUx0Uhj3jgmV0e1UwUDsNQ9gPs&libraries=places&callback=initMap"></script>




  <!-- <script src="./js/index.js"></script> -->
</body>

</html>